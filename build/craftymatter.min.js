!function(a){"use strict";function b(){m&&Crafty.e("Actor, Color").attr({x:0,y:0,w:d.world.bounds.max.x,h:d.world.bounds.max.y,alpha:.5}).color("green")}function c(a){var b=2,c=Crafty.e("Actor"),d=Crafty.e("Actor, Color"),e=Crafty.e("Actor, Color"),f=Crafty.e("Actor, Color"),g=Crafty.e("Actor, Color"),h=Crafty.e("Actor, Color");return c.attach(d),c.attach(e),c.attach(f),c.attach(g),c.attach(h),c.attr({x:a.vertices[0].x,y:a.vertices[0].y,w:a.vertices[2].x-a.vertices[0].x,h:a.vertices[2].y-a.vertices[0].y}),c.origin("center"),d.color("blue"),d.alpha=.5,d.z=c._z+1,d.origin("center"),e.color("blue"),e.h=b,e.z=c._z+1,e.origin("center"),f.color("blue"),f.x=d._x+(d._w-b),f.w=b,f.z=c._z+1,f.origin("center"),g.color("blue"),g.y=d._y+(d._h-b),g.h=b,g.z=c._z+1,g.origin("center"),h.color("blue"),h.w=b,h.z=c._z+1,h.origin("center"),c}var d,e=a.World,f=a.Engine,g=a.Bodies,h=a.Body,i=a.Common,j=a.Composite,l=a.Vector,m=!1,n=[],o={};!function(a){a.create=function(b){var c={controller:a,element:null,options:{width:640,height:960,wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!1,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1}},d=i.extend(c,b);return d.textures={},d.bounds=d.bounds||{min:{x:0,y:0},max:{x:d.options.width,y:d.options.height}},d},a.world=function(b){var c,d,e,f,g,h,i,k,m,n,o,p=b.render,q=b.world,r=p.options,s=j.allBodies(q),t=j.allConstraints(q),u=[],v=[];if(r.hasBounds){for(c=p.bounds.max.x-p.bounds.min.x,d=p.bounds.max.y-p.bounds.min.y,e=c/r.width,f=d/r.height,o=0;o<s.length;o++)g=s[o],Bounds.overlaps(g.bounds,p.bounds)&&u.push(g);for(o=0;o<t.length;o++)h=t[o],i=h.bodyA,k=h.bodyB,m=h.pointA,n=h.pointB,i&&(m=l.add(i.position,h.pointA)),k&&(n=l.add(k.position,h.pointB)),m&&n&&(Bounds.contains(p.bounds,m)||Bounds.contains(p.bounds,n))&&v.push(h)}else v=t,u=s;a.bodies(b,u),r.showDebug&&a.debug(b)},a.debug=function(a){var c=b(a.world.bounds.max.x,a.world.bounds.max.y);c.width=a.world.bounds.max.x,c.height=a.world.bounds.max.y,c.style.zIndex=8,c.style.position="absolute";var d=c.getContext("2d"),e=a.world,f=a.render,g=f.options,h=j.allBodies(e),i="    ";if(document.body.appendChild(c),a.timing.timestamp-(f.debugTimestamp||0)>=500){var k="";k+="fps: "+Math.round(a.timing.fps)+i,a.metrics.extended&&(k+="delta: "+a.timing.delta.toFixed(3)+i,k+="correction: "+a.timing.correction.toFixed(3)+i,k+="bodies: "+h.length+i,a.broadphase.controller===Grid&&(k+="buckets: "+a.metrics.buckets+i),k+="\n",k+="collisions: "+a.metrics.collisions+i,k+="pairs: "+a.pairs.list.length+i,k+="broad: "+a.metrics.broadEff+i,k+="mid: "+a.metrics.midEff+i,k+="narrow: "+a.metrics.narrowEff+i),f.debugString=k,f.debugTimestamp=a.timing.timestamp}if(f.debugString){d.font="12px Arial",g.wireframes?d.fillStyle="rgba(255,255,255,0.5)":d.fillStyle="rgba(0,0,0,0.5)";for(var l=f.debugString.split("\n"),m=0;m<l.length;m++)d.fillText(l[m],50,50+18*m)}},a.constraints=function(a,b){for(var c=b,d=0;d<a.length;d++){var e=a[d];if(e.render.visible&&e.pointA&&e.pointB){var f=e.bodyA,g=e.bodyB;f?(c.beginPath(),c.moveTo(f.position.x+e.pointA.x,f.position.y+e.pointA.y)):(c.beginPath(),c.moveTo(e.pointA.x,e.pointA.y)),g?c.lineTo(g.position.x+e.pointB.x,g.position.y+e.pointB.y):c.lineTo(e.pointB.x,e.pointB.y),c.lineWidth=e.render.lineWidth,c.strokeStyle=e.render.strokeStyle,c.stroke()}}},a.bodies=function(a,b){var d,e,f,g=a.render,h=g.options;for(f=0;f<b.length;f++)if(d=b[f],e=d.entity,d.render.visible)if(d.parts)for(k=d.parts.length>1?1:0;k<d.parts.length;k++)c(h,d.parts[k],d.isSleeping);else c(h,d,d.isSleeping)};var b=function(a,b){var c=document.createElement("canvas");return c.width=a,c.height=b,c.oncontextmenu=function(){return!1},c.onselectstart=function(){return!1},c},c=function(a,b,c){var e=b.entity;a.showSleeping&&c&&(e.alpha=.5),e.matterMoved=!0,e.x=b.position.x-e._w/2,e.matterMoved=!0,e.y=b.position.y-e._h/2,m&&(e._debugBody.x=e._x,e._debugBody.y=e._y),d(e,b.angle)},d=function(a,b){a.rotation=0,0!==b&&(a.rotation=Crafty.math.radToDeg(b),m&&(a._debugBody.rotation=Crafty.math.radToDeg(b)))}}(o),Crafty.extend({Matter:function(){return{init:function(c){d=f.create({render:{controller:o,options:{width:Crafty.viewport.width,height:Crafty.viewport.height,showDebug:!1}},world:{bounds:{min:{x:0,y:0},max:{x:Crafty.viewport.width,y:Crafty.viewport.height}}}}),c&&(c.debug&&(m=c.debug),c.gravity&&(d.world.gravity=c.gravity)),d.world.bounds.max={x:Crafty.viewport.width,y:Crafty.viewport.height};var g=a.MouseConstraint.create(d);e.add(d.world,g),b(),Crafty.bind("EnterFrame",function(b){a.Events.trigger(d,"beforeTick",event),f.update(d,b.dt,1),f.render(d),a.Events.trigger(d,"afterTick",event)})},destroy:function(){}}}()}),Crafty.c("Matter",function(){var b=function(a){this.origin(a.w/2,a.h/2),n.push(this);var b={};a.matter&&(b=a.matter),this._body=g.rectangle(a.x+a.w/2,a.y+a.h/2,a.w,a.h,b),this._body.entity=this,this.matterMoved=!1,m&&(this._debugBody=c(this._body)),a.rotation&&h.setAngle(this._body,Crafty.math.degToRad(a.rotation)),e.addBody(d.world,this._body)};return{init:function(){this.requires("2D"),this.bind("Change",function(a){return a&&a.hasOwnProperty("x")&&a.hasOwnProperty("y")?b.call(this,a):void 0}.bind(this)),this.bind("Move",function(b){this.matterMoved?this.matterMoved=!1:a.Body.setPosition(this._body,{x:this._x+this._w/2,y:this._y+this._h/2})}.bind(this))}}}())}(Matter);
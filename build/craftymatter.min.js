!function(a){"use strict";function b(a){function b(){Crafty.e(n+", Color").attr({x:0,y:0,w:c.world.bounds.max.x,h:c.world.bounds.max.y,alpha:.5}).color("green")}function d(a){var b=2,c=Crafty.e(n),d=Crafty.e(n+", Color"),e=Crafty.e(n+", Color"),f=Crafty.e(n+", Color"),g=Crafty.e(n+", Color"),h=Crafty.e(n+", Color");c.attach(d),c.attach(e),c.attach(f),c.attach(g),c.attach(h);for(var i={x:a.vertices[0].x,y:a.vertices[0].y,w:a.vertices[0].x,h:a.vertices[0].y},j=1;j<a.vertices.length;j++)a.vertices[j].x<i.x&&(i.x=a.vertices[j].x),a.vertices[j].y<i.y&&(i.y=a.vertices[j].y),a.vertices[j].x>i.w&&(i.w=a.vertices[j].x),a.vertices[j].y>i.h&&(i.h=a.vertices[j].y);return c.attr({x:i.x,y:i.y,w:Math.abs(i.w-i.x),h:Math.abs(i.h-i.y)}),c.origin("center"),d.color("blue"),d.alpha=.5,d.z=c._z+1,d.origin("center"),e.color("blue"),e.h=b,e.z=c._z+1,e.origin("center"),f.color("blue"),f.x=d._x+(d._w-b),f.w=b,f.z=c._z+1,f.origin("center"),g.color("blue"),g.y=d._y+(d._h-b),g.h=b,g.z=c._z+1,g.origin("center"),h.color("blue"),h.w=b,h.z=c._z+1,h.origin("center"),c}function e(a){a._debugBody.x=a._x,a._debugBody.y=a._y}function f(a){a[0]._debugBody.rotation=a[1]}function g(a,b){return this.debugAllowed?this[a](b):void 0}var h=a||!1,i={debugAllowed:h};return i.worldDebug=g.bind(i,"worldDebugAllowed"),i.generateDebugBody=g.bind(i,"generateDebugBodyAllowed"),i.moveEntity=g.bind(i,"moveEntityAllowed"),i.rotateEntity=g.bind(i,"rotateEntityAllowed"),i.worldDebugAllowed=b,i.generateDebugBodyAllowed=d,i.moveEntityAllowed=e,i.rotateEntityAllowed=f,i}var c,d=a.World,e=a.Engine,f=a.Bodies,g=a.Body,h=a.Common,i=a.Composite,j=a.Vector,l=b(!1),m=[],n="2D, DOM",o={};!function(a){a.create=function(b){var c={controller:a,element:null,options:{width:640,height:960,wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!1,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1}},d=h.extend(c,b);return d.textures={},d.bounds=d.bounds||{min:{x:0,y:0},max:{x:d.options.width,y:d.options.height}},d},a.world=function(b){var c,d,e,f,g,h,k,m,n,o,p,q=b.render,r=b.world,s=q.options,t=i.allBodies(r),u=i.allConstraints(r),v=[],w=[];if(s.hasBounds){for(c=q.bounds.max.x-q.bounds.min.x,d=q.bounds.max.y-q.bounds.min.y,e=c/s.width,f=d/s.height,p=0;p<t.length;p++)g=t[p],Bounds.overlaps(g.bounds,q.bounds)&&v.push(g);for(p=0;p<u.length;p++)h=u[p],k=h.bodyA,m=h.bodyB,n=h.pointA,o=h.pointB,k&&(n=j.add(k.position,h.pointA)),m&&(o=j.add(m.position,h.pointB)),n&&o&&(Bounds.contains(q.bounds,n)||Bounds.contains(q.bounds,o))&&w.push(h)}else w=u,v=t;a.bodies(b,v),l.debugAllowed&&a.constraints(w),s.showDebug&&a.debug(b)},a.debug=function(a){var c=b(a.world.bounds.max.x,a.world.bounds.max.y);c.width=a.world.bounds.max.x,c.height=a.world.bounds.max.y,c.style.zIndex=8,c.style.position="absolute";var d=c.getContext("2d"),e=a.world,f=a.render,g=f.options,h=i.allBodies(e),j="    ";if(document.body.appendChild(c),a.timing.timestamp-(f.debugTimestamp||0)>=500){var k="";k+="fps: "+Math.round(a.timing.fps)+j,a.metrics.extended&&(k+="delta: "+a.timing.delta.toFixed(3)+j,k+="correction: "+a.timing.correction.toFixed(3)+j,k+="bodies: "+h.length+j,a.broadphase.controller===Grid&&(k+="buckets: "+a.metrics.buckets+j),k+="\n",k+="collisions: "+a.metrics.collisions+j,k+="pairs: "+a.pairs.list.length+j,k+="broad: "+a.metrics.broadEff+j,k+="mid: "+a.metrics.midEff+j,k+="narrow: "+a.metrics.narrowEff+j),f.debugString=k,f.debugTimestamp=a.timing.timestamp}if(f.debugString){d.font="12px Arial",g.wireframes?d.fillStyle="rgba(255,255,255,0.5)":d.fillStyle="rgba(0,0,0,0.5)";for(var l=f.debugString.split("\n"),m=0;m<l.length;m++)d.fillText(l[m],50,50+18*m)}},a.constraints=function(a){for(var b,c,d,g,h=0;h<a.length;h++)b=a[h],b.render.visible&&b.pointA&&b.pointB&&(b.entity||(b.entity=Crafty.e(n+", Color").color("white")),b.entity.h=.005*Crafty.viewport.height,c=b.bodyA,d=b.bodyB,c?(b.entity.x=c.position.x+b.pointA.x,b.entity.y=c.position.y+b.pointA.y):(b.entity.x=b.pointA.x,b.entity.y=b.pointA.y),g=d?{x:d.position.x+b.pointB.x,y:d.position.y+b.pointB.y}:{x:b.pointB.x,y:b.pointB.y},b.entity.w=e({x:b.entity._x,y:b.entity._y},g),b.entity.rotation=f({x:b.entity._x,y:b.entity._y},g))},a.bodies=function(a,b){var d,e,f,g=a.render,h=g.options;for(f=0;f<b.length;f++)if(d=b[f],e=d.entity,d.render.visible)if(d.parts)for(k=d.parts.length>1?1:0;k<d.parts.length;k++)c(h,d.parts[k],d.isSleeping);else c(h,d,d.isSleeping)};var b=function(a,b){var c=document.createElement("canvas");return c.width=a,c.height=b,c.oncontextmenu=function(){return!1},c.onselectstart=function(){return!1},c},c=function(a,b,c){var e=b.entity;a.showSleeping&&c&&(e.alpha=.5),e._x!==b.position.x-e._w/2&&(e.matterMoved=!0,e.x=b.position.x-e._w/2),e._y!==b.position.y-e._h/2&&(e.matterMoved=!0,e.y=b.position.y-e._h/2),l.moveEntity(e),d(e,b.angle)},d=function(a,b){var c=Crafty.math.radToDeg(b).toFixed(3);0!==b&&a._rotation!==c&&(a.matterMoved=!0,a.rotation=c,l.rotateEntity([a,c]))},e=function(a,b){var c=g(a,b);return j.magnitude(c)},f=function(a,b){var c=g(a,b);return-Crafty.math.radToDeg(Math.atan2(c.y,c.x)).toFixed(3)},g=function(a,b){return j.create(b.x-a.x,-(b.y-a.y))}}(o),Crafty.extend({Matter:function(){return{init:function(b){c=e.create({render:{controller:o,options:{width:Crafty.viewport.width,height:Crafty.viewport.height,showDebug:!1}},world:{bounds:{min:{x:0,y:0},max:{x:Crafty.viewport.width,y:Crafty.viewport.height}}}}),b&&(b.debug&&(l.debugAllowed=b.debug),b.gravity&&(c.world.gravity=b.gravity),b.size&&(c.world.bounds.max={x:b.size.x,y:b.size.y}),b.renderingMode&&"Canvas"===b.renderingMode&&(n="2D, Canvas")),l.worldDebug(),Crafty.bind("EnterFrame",function(b){a.Events.trigger(c,"beforeTick",event),e.update(c,b.dt,1),e.render(c),a.Events.trigger(c,"afterTick",event)}),this.engine=c,this.world=c.world},destroy:function(){},engine:{},world:{}}}()}),Crafty.c("Matter",function(){var a=function(a){this.origin(a.w/2,a.h/2),m.push(this);var b={};a.matter&&(b=a.matter),b.shape&&"circle"===b.shape?this._body=f.circle(a.x+a.w/2,a.y+a.h/2,a.matter.radius,b):this._body=f.rectangle(a.x+a.w/2,a.y+a.h/2,a.w,a.h,b),this._body.entity=this,this.matterMoved=!1,this._debugBody=l.generateDebugBody(this._body),a.rotation&&g.setAngle(this._body,Crafty.math.degToRad(a.rotation)),d.addBody(c.world,this._body)};return{init:function(){this.requires("2D"),this.bind("Change",function(b){return b&&b.hasOwnProperty("x")&&b.hasOwnProperty("y")?a.call(this,b):void 0}.bind(this)),this.bind("Move",function(a){this.matterMoved||"undefined"==typeof this._body?this.matterMoved=!1:g.setPosition(this._body,{x:this._x+this._w/2,y:this._y+this._h/2})}.bind(this)),this.bind("Rotate",function(a){this.matterMoved?this.matterMoved=!1:g.setAngle(this._body,Crafty.math.degToRad(this.rotation))}.bind(this))},remove:function(a){d.remove(c.world,this._body,!0),"undefined"!=typeof this._debugBody&&this._debugBody.destroy()}}}())}(Matter);
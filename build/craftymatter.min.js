var Matter=require("matter-js");!function(){"use strict";function a(a){function c(){Crafty.e(o+", Color").attr({x:b.world.bounds.min.x,y:b.world.bounds.min.y,w:b.world.bounds.max.x-b.world.bounds.min.x,h:b.world.bounds.max.y-b.world.bounds.min.y,alpha:.5}).color("green")}function d(a){var b=2,c=Crafty.e(o),d=Crafty.e(o+", Color"),e=Crafty.e(o+", Color"),f=Crafty.e(o+", Color"),g=Crafty.e(o+", Color"),h=Crafty.e(o+", Color");c.attach(d),c.attach(e),c.attach(f),c.attach(g),c.attach(h);for(var i={x:a.vertices[0].x,y:a.vertices[0].y,w:a.vertices[0].x,h:a.vertices[0].y},j=1;j<a.vertices.length;j++)a.vertices[j].x<i.x&&(i.x=a.vertices[j].x),a.vertices[j].y<i.y&&(i.y=a.vertices[j].y),a.vertices[j].x>i.w&&(i.w=a.vertices[j].x),a.vertices[j].y>i.h&&(i.h=a.vertices[j].y);return c.attr({x:i.x,y:i.y,w:Math.abs(i.w-i.x),h:Math.abs(i.h-i.y)}),c.origin("center"),d.color("blue"),d.alpha=.5,d.z=c._z+1,d.origin("center"),e.color("blue"),e.h=b,e.z=c._z+1,e.origin("center"),f.color("blue"),f.x=d._x+(d._w-b),f.w=b,f.z=c._z+1,f.origin("center"),g.color("blue"),g.y=d._y+(d._h-b),g.h=b,g.z=c._z+1,g.origin("center"),h.color("blue"),h.w=b,h.z=c._z+1,h.origin("center"),c}function e(a){a._debugBody.x=a._x,a._debugBody.y=a._y}function f(a){a[0]._debugBody.rotation=a[1]}function g(a,b){return this.debugAllowed?this[a](b):void 0}var h=a||!1,i={debugAllowed:h};return i.worldDebug=g.bind(i,"worldDebugAllowed"),i.generateDebugBody=g.bind(i,"generateDebugBodyAllowed"),i.moveEntity=g.bind(i,"moveEntityAllowed"),i.rotateEntity=g.bind(i,"rotateEntityAllowed"),i.worldDebugAllowed=c,i.generateDebugBodyAllowed=d,i.moveEntityAllowed=e,i.rotateEntityAllowed=f,i}var b,c=Matter.Bodies,d=Matter.Body,e=Matter.Bounds,f=Matter.Common,g=Matter.Composite,h=Matter.Engine,i=Matter.Events,j=Matter.Mouse,k=Matter.Vector,l=Matter.World,m=a(!1),n=[],o="2D, Canvas";h.run=function(a,b){a.enabled&&(i.trigger(a,"beforeTick",event),i.trigger(a,"tick",event),h.update(a,b.dt,1),q(a),p(a),h.render(a),i.trigger(a,"afterTick",event))};var p=function(a){var b=a.input.mouse,c=b.sourceEvents;c.mousemove&&i.trigger(a,"mousemove",{mouse:b}),c.mousedown&&i.trigger(a,"mousedown",{mouse:b}),c.mouseup&&i.trigger(a,"mouseup",{mouse:b}),j.clearSourceEvents(b)},q=function(a){var b=a.pairs;b.collisionStart.length>0&&i.trigger(a,"collisionStart",{pairs:b.collisionStart}),b.collisionActive.length>0&&i.trigger(a,"collisionActive",{pairs:b.collisionActive}),b.collisionEnd.length>0&&i.trigger(a,"collisionEnd",{pairs:b.collisionEnd})},r={};!function(a){a.create=function(b){var c={controller:a,element:null,options:{width:640,height:960,wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!1,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1}},d=f.extend(c,b);return d.textures={},d.bounds=d.bounds||{min:{x:0,y:0},max:{x:d.options.width,y:d.options.height}},d},a.world=function(b){var c,d,f,h,i,j,l,n=b.render,o=b.world,p=n.options,q=g.allBodies(o),r=g.allConstraints(o),s=[],t=[];if(p.hasBounds){for(l=0;l<q.length;l++)c=q[l],e.overlaps(c.bounds,n.bounds)&&s.push(c);for(l=0;l<r.length;l++)d=r[l],f=d.bodyA,h=d.bodyB,i=d.pointA,j=d.pointB,f&&(i=k.add(f.position,d.pointA)),h&&(j=k.add(h.position,d.pointB)),i&&j&&(e.contains(n.bounds,i)||e.contains(n.bounds,j))&&t.push(d)}else t=r,s=q;a.bodies(b,s),m.debugAllowed&&a.constraints(t),p.showDebug&&a.debug(b)},a.debug=function(a){var c=b(a.world.bounds.max.x,a.world.bounds.max.y);c.width=a.world.bounds.max.x,c.height=a.world.bounds.max.y,c.style.zIndex=8,c.style.position="absolute";var d=c.getContext("2d"),e=a.world,f=a.render,h=f.options,i=g.allBodies(e),j="    ";if(document.body.appendChild(c),a.timing.timestamp-(f.debugTimestamp||0)>=500){var k="";k+="fps: "+Math.round(a.timing.fps)+j,a.metrics.extended&&(k+="delta: "+a.timing.delta.toFixed(3)+j,k+="correction: "+a.timing.correction.toFixed(3)+j,k+="bodies: "+i.length+j,a.broadphase.controller===Grid&&(k+="buckets: "+a.metrics.buckets+j),k+="\n",k+="collisions: "+a.metrics.collisions+j,k+="pairs: "+a.pairs.list.length+j,k+="broad: "+a.metrics.broadEff+j,k+="mid: "+a.metrics.midEff+j,k+="narrow: "+a.metrics.narrowEff+j),f.debugString=k,f.debugTimestamp=a.timing.timestamp}if(f.debugString){d.font="12px Arial",h.wireframes?d.fillStyle="rgba(255,255,255,0.5)":d.fillStyle="rgba(0,0,0,0.5)";for(var l=f.debugString.split("\n"),m=0;m<l.length;m++)d.fillText(l[m],50,50+18*m)}},a.constraints=function(a){for(var b,c,d,e,f=0;f<a.length;f++)b=a[f],b.render.visible&&b.pointA&&b.pointB&&(b.entity||(b.entity=Crafty.e(o+", Color").color("white")),b.entity.h=.005*Crafty.viewport.height,c=b.bodyA,d=b.bodyB,c?(b.entity.x=c.position.x+b.pointA.x,b.entity.y=c.position.y+b.pointA.y):(b.entity.x=b.pointA.x,b.entity.y=b.pointA.y),e=d?{x:d.position.x+b.pointB.x,y:d.position.y+b.pointB.y}:{x:b.pointB.x,y:b.pointB.y},b.entity.w=h({x:b.entity._x,y:b.entity._y},e),b.entity.rotation=i({x:b.entity._x,y:b.entity._y},e))},a.bodies=function(a,b){var d,e,f,g,h=a.render,i=h.options;for(f=0;f<b.length;f++)if(d=b[f],e=d.entity,d.render.visible)if(d.parts)for(g=d.parts.length>1?1:0;g<d.parts.length;g++)c(i,d.parts[g],d.isSleeping);else c(i,d,d.isSleeping)};var b=function(a,b){var c=document.createElement("canvas");return c.width=a,c.height=b,c.oncontextmenu=function(){return!1},c.onselectstart=function(){return!1},c},c=function(a,b,c){var e=b.entity;a.showSleeping&&c&&(e.alpha=.5),e._x!==b.position.x-e._w/2&&(e.matterMoved=!0,e.x=b.position.x-e._w/2),e._y!==b.position.y-e._h/2&&(e.matterMoved=!0,e.y=b.position.y-e._h/2),m.moveEntity(e),d(e,b.angle)},d=function(a,b){var c=Crafty.math.radToDeg(b).toFixed(3);0!==b&&a._rotation!==c&&(a.matterMoved=!0,a.rotation=c,m.rotateEntity([a,c]))},h=function(a,b){var c=j(a,b);return k.magnitude(c)},i=function(a,b){var c=j(a,b);return-Crafty.math.radToDeg(Math.atan2(c.y,c.x)).toFixed(3)},j=function(a,b){return{x:b.x-a.x,y:-(b.y-a.y)}}}(r),Crafty.extend({Matter:function(){return{init:function(a){b=h.create({render:{controller:r,options:{width:Crafty.viewport.width,height:Crafty.viewport.height,hasBounds:a.hasBounds||!1,showDebug:!1}},world:{bounds:a.bounds||{min:{x:0,y:0},max:{x:Crafty.viewport.width,y:Crafty.viewport.height}}}}),a&&(a.debug&&(m.debugAllowed=a.debug),a.gravity&&(b.world.gravity=a.gravity),a.size&&(b.world.bounds.max={x:a.size.x,y:a.size.y}),a.renderingMode&&"Canvas"===a.renderingMode&&(o="2D, Canvas")),m.worldDebug(),Crafty.bind("EnterFrame",function(a){h.run(b,a)}),this.engine=b,this.world=b.world},destroy:function(){},engine:{},world:{}}}()}),Crafty.c("Matter",function(){var a=function(a){var e={x:a.x||0,y:a.y||0,w:a.w||0,h:a.h||0};this.origin(e.w/2,e.h/2),n.push(this);var f={};if(a.matter&&(f=a.matter),f.shape&&"circle"===f.shape){var g=e.w/2;a.matter.radius&&(g=a.matter.radius),this._body=c.circle(e.x+e.w/2,e.y+e.h/2,g,f)}else this._body=c.rectangle(e.x+e.w/2,e.y+e.h/2,e.w,e.h,f);this._body.entity=this,this.matterMoved=!1,this._debugBody=m.generateDebugBody(this._body),a.rotation&&d.setAngle(this._body,Crafty.math.degToRad(a.rotation)),l.addBody(b.world,this._body)};return{init:function(){this.requires("2D"),this.bind("Change",function(b){return b&&b.hasOwnProperty("x")&&b.hasOwnProperty("y")?a.call(this,b):void 0}.bind(this)),this.bind("Move",function(){this.matterMoved||"undefined"==typeof this._body?this.matterMoved=!1:d.setPosition(this._body,{x:this._x+this._w/2,y:this._y+this._h/2})}.bind(this)),this.bind("Rotate",function(){this.matterMoved?this.matterMoved=!1:d.setAngle(this._body,Crafty.math.degToRad(this.rotation))}.bind(this))},remove:function(){l.remove(b.world,this._body,!0),"undefined"!=typeof this._debugBody&&this._debugBody.destroy()}}}())}();